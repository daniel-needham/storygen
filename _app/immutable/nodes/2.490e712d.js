import{s as Ke,n as Ze,r as et,o as tt,a as st,b as ot}from"../chunks/scheduler.e108d1fd.js";import{S as nt,i as it,g as a,s as T,h as u,y as G,c as w,j as m,f as h,k as t,z as b,a as ze,x as s,A as p,B as lt,H as rt,C as at}from"../chunks/index.7e4bc2c2.js";import"../chunks/paths.a08af92f.js";function $e(e){return(e==null?void 0:e.length)!==void 0?e:Array.from(e)}function Je(e,d,f){const P=e.slice();return P[28]=d[f],P}function Qe(e){let d,f,P=e[28]+"";return{c(){d=a("p"),f=new rt(!1),this.h()},l(x){d=u(x,"P",{class:!0});var r=m(d);f=at(r,!1),r.forEach(h),this.h()},h(){f.a=null,t(d,"class","svelte-3q1ywz")},m(x,r){ze(x,d,r),f.m(P,d)},p(x,r){r&4&&P!==(P=x[28]+"")&&f.p(P)},d(x){x&&h(d)}}}function ut(e){let d,f="<title>StoryGen</title>",P,x,r,E,N,X,we=`<p id="label_1" class="svelte-3q1ywz"><b>Exposition</b><br/>The status quo or ‘ordinary world’ is
          established.</p> <p id="label_2" class="svelte-3q1ywz"><b>Inciting Incident</b><br/>An event that sets the story in motion.</p> <p id="label_3" class="svelte-3q1ywz"><b>Plot Point A</b><br/>The protagonist decides to tackle the
          challenge head-on. They ‘cross the threshold,’ and the story is now
          truly moving.</p>`,ve,R,I,ne,C,_e,O,ie,V,Y,le=`<p id="label_4" class="svelte-3q1ywz"><b>Rising Action</b><br/>The story&#39;s true stakes become clear; our
          hero grows familiar with their ‘new world’ and has their first
          encounters with some enemies and allies.</p> <p id="label_5" class="svelte-3q1ywz"><b>Midpoint</b><br/>An event that upends the protagonist’s mission.</p> <p id="label_6" class="svelte-3q1ywz"><b>Plot Point B</b><br/>In the wake of the disorienting midpoint, the
          protagonist is tested — and fails. Their ability to succeed is now in
          doubt.</p>`,ge,k,M,ye,D,be,L,Pe,U,W,v=`<p id="label_7" class="svelte-3q1ywz"><b>Pre Climax</b><br/>Night is darkest before dawn. The protagonist
          must pull themselves together and choose between decisive action and
          failure.</p> <p id="label_8" class="svelte-3q1ywz"><b>Climax</b><br/>They face off against their antagonist one last
          time. Will they prevail?</p> <p id="label_9" class="svelte-3q1ywz"><b>Denouement</b><br/>All loose ends are tied up. The reader
          discovers the consequences of the climax. A new status quo is
          established.</p>`,i,o,n,g,l,q,y,B,z,j,re='<label for="premise">Story Premise</label> <textarea id="premise" name="premise" class="svelte-3q1ywz"></textarea>',Te,ae,ue,Ge="Genre",Oe,Z,$,He="Science Fiction ",J,Ve="Love Stories ",Q,Ue="Ghost Stories",Ce,ce,je='<button type="submit" class="svelte-3q1ywz">Generate Story!</button> <button type="reset" class="svelte-3q1ywz">Reset</button>',Me,pe,De,K,ee,F,Fe="Close",Le,te,Xe="Download",Re,se,ke,Ye,he=$e(e[2]),A=[];for(let c=0;c<he.length;c+=1)A[c]=Qe(Je(e,he,c));return{c(){d=a("head"),d.innerHTML=f,P=T(),x=a("body"),r=a("div"),E=a("form"),N=a("div"),X=a("div"),X.innerHTML=we,ve=T(),R=a("div"),I=a("textarea"),ne=T(),C=a("textarea"),_e=T(),O=a("textarea"),ie=T(),V=a("div"),Y=a("div"),Y.innerHTML=le,ge=T(),k=a("div"),M=a("textarea"),ye=T(),D=a("textarea"),be=T(),L=a("textarea"),Pe=T(),U=a("div"),W=a("div"),W.innerHTML=v,i=T(),o=a("div"),n=a("textarea"),g=T(),l=a("textarea"),q=T(),y=a("textarea"),B=T(),z=a("div"),j=a("p"),j.innerHTML=re,Te=T(),ae=a("p"),ue=a("label"),ue.textContent=Ge,Oe=T(),Z=a("select"),$=a("option"),$.textContent=He,J=a("option"),J.textContent=Ve,Q=a("option"),Q.textContent=Ue,Ce=T(),ce=a("div"),ce.innerHTML=je,Me=T(),pe=a("div"),De=T(),K=a("div"),ee=a("div"),F=a("button"),F.textContent=Fe,Le=T(),te=a("button"),te.textContent=Xe,Re=T(),se=a("div");for(let c=0;c<A.length;c+=1)A[c].c();this.h()},l(c){d=u(c,"HEAD",{"data-svelte-h":!0}),G(d)!=="svelte-4z3owu"&&(d.innerHTML=f),P=w(c),x=u(c,"BODY",{class:!0});var S=m(x);r=u(S,"DIV",{class:!0});var _=m(r);E=u(_,"FORM",{});var H=m(E);N=u(H,"DIV",{class:!0});var Ee=m(N);X=u(Ee,"DIV",{class:!0,"data-svelte-h":!0}),G(X)!=="svelte-11g2meq"&&(X.innerHTML=we),ve=w(Ee),R=u(Ee,"DIV",{class:!0});var de=m(R);I=u(de,"TEXTAREA",{id:!0,name:!0,class:!0}),m(I).forEach(h),ne=w(de),C=u(de,"TEXTAREA",{id:!0,name:!0,class:!0}),m(C).forEach(h),_e=w(de),O=u(de,"TEXTAREA",{id:!0,name:!0,class:!0}),m(O).forEach(h),de.forEach(h),Ee.forEach(h),ie=w(H),V=u(H,"DIV",{class:!0});var xe=m(V);Y=u(xe,"DIV",{class:!0,"data-svelte-h":!0}),G(Y)!=="svelte-qkt8ed"&&(Y.innerHTML=le),ge=w(xe),k=u(xe,"DIV",{class:!0});var me=m(k);M=u(me,"TEXTAREA",{id:!0,name:!0,class:!0}),m(M).forEach(h),ye=w(me),D=u(me,"TEXTAREA",{id:!0,name:!0,class:!0}),m(D).forEach(h),be=w(me),L=u(me,"TEXTAREA",{id:!0,name:!0,class:!0}),m(L).forEach(h),me.forEach(h),xe.forEach(h),Pe=w(H),U=u(H,"DIV",{class:!0});var Ie=m(U);W=u(Ie,"DIV",{class:!0,"data-svelte-h":!0}),G(W)!=="svelte-knbzn7"&&(W.innerHTML=v),i=w(Ie),o=u(Ie,"DIV",{class:!0});var fe=m(o);n=u(fe,"TEXTAREA",{id:!0,name:!0,class:!0}),m(n).forEach(h),g=w(fe),l=u(fe,"TEXTAREA",{id:!0,name:!0,class:!0}),m(l).forEach(h),q=w(fe),y=u(fe,"TEXTAREA",{id:!0,name:!0,class:!0}),m(y).forEach(h),fe.forEach(h),Ie.forEach(h),B=w(H),z=u(H,"DIV",{class:!0,id:!0});var oe=m(z);j=u(oe,"P",{"data-svelte-h":!0}),G(j)!=="svelte-102byll"&&(j.innerHTML=re),Te=w(oe),ae=u(oe,"P",{});var Se=m(ae);ue=u(Se,"LABEL",{for:!0,"data-svelte-h":!0}),G(ue)!=="svelte-pcardo"&&(ue.textContent=Ge),Oe=w(Se),Z=u(Se,"SELECT",{name:!0,id:!0});var qe=m(Z);$=u(qe,"OPTION",{"data-svelte-h":!0}),G($)!=="svelte-1mfk9b9"&&($.textContent=He),J=u(qe,"OPTION",{"data-svelte-h":!0}),G(J)!=="svelte-p8j5fh"&&(J.textContent=Ve),Q=u(qe,"OPTION",{"data-svelte-h":!0}),G(Q)!=="svelte-ll1gq9"&&(Q.textContent=Ue),qe.forEach(h),Se.forEach(h),Ce=w(oe),ce=u(oe,"DIV",{"data-svelte-h":!0}),G(ce)!=="svelte-1tow0et"&&(ce.innerHTML=je),Me=w(oe),pe=u(oe,"DIV",{id:!0,class:!0}),m(pe).forEach(h),oe.forEach(h),H.forEach(h),De=w(_),K=u(_,"DIV",{id:!0,class:!0});var Ae=m(K);ee=u(Ae,"DIV",{id:!0,class:!0});var Ne=m(ee);F=u(Ne,"BUTTON",{type:!0,id:!0,class:!0,"data-svelte-h":!0}),G(F)!=="svelte-bxyngi"&&(F.textContent=Fe),Le=w(Ne),te=u(Ne,"BUTTON",{type:!0,id:!0,class:!0,"data-svelte-h":!0}),G(te)!=="svelte-mmndu3"&&(te.textContent=Xe),Ne.forEach(h),Re=w(Ae),se=u(Ae,"DIV",{id:!0,class:!0});var We=m(se);for(let Be=0;Be<A.length;Be+=1)A[Be].l(We);We.forEach(h),Ae.forEach(h),_.forEach(h),S.forEach(h),this.h()},h(){t(X,"class","labels svelte-3q1ywz"),t(I,"id","input_1"),t(I,"name","input_1"),t(I,"class","svelte-3q1ywz"),t(C,"id","input_2"),t(C,"name","input_2"),t(C,"class","svelte-3q1ywz"),t(O,"id","input_3"),t(O,"name","input_3"),t(O,"class","svelte-3q1ywz"),t(R,"class","group svelte-3q1ywz"),t(N,"class","box"),t(Y,"class","labels svelte-3q1ywz"),t(M,"id","input_4"),t(M,"name","input_4"),t(M,"class","svelte-3q1ywz"),t(D,"id","input_5"),t(D,"name","input_5"),t(D,"class","svelte-3q1ywz"),t(L,"id","input_6"),t(L,"name","input_6"),t(L,"class","svelte-3q1ywz"),t(k,"class","group svelte-3q1ywz"),t(V,"class","box"),t(W,"class","labels svelte-3q1ywz"),t(n,"id","input_7"),t(n,"name","input_7"),t(n,"class","svelte-3q1ywz"),t(l,"id","input_8"),t(l,"name","input_8"),t(l,"class","svelte-3q1ywz"),t(y,"id","input_9"),t(y,"name","input_9"),t(y,"class","svelte-3q1ywz"),t(o,"class","group svelte-3q1ywz"),t(U,"class","box"),t(ue,"for","genre"),$.__value="science_fiction",b($,$.__value),J.__value="love_stories",b(J,J.__value),Q.__value="ghost_stories",b(Q,Q.__value),t(Z,"name","genre"),t(Z,"id","genre"),t(pe,"id","loading_spinner"),t(pe,"class","hide svelte-3q1ywz"),t(z,"class","box svelte-3q1ywz"),t(z,"id","bottom"),t(F,"type","button"),t(F,"id","close"),t(F,"class","svelte-3q1ywz"),t(te,"type","button"),t(te,"id","download"),t(te,"class","svelte-3q1ywz"),t(ee,"id","buttonContainer"),t(ee,"class","svelte-3q1ywz"),t(se,"id","scrollDiv"),t(se,"class","svelte-3q1ywz"),t(K,"id","story"),t(K,"class","hide svelte-3q1ywz"),t(r,"class","container svelte-3q1ywz"),t(x,"class","svelte-3q1ywz")},m(c,S){ze(c,d,S),ze(c,P,S),ze(c,x,S),s(x,r),s(r,E),s(E,N),s(N,X),s(N,ve),s(N,R),s(R,I),b(I,e[1][1]),s(R,ne),s(R,C),b(C,e[1][2]),s(R,_e),s(R,O),b(O,e[1][3]),s(E,ie),s(E,V),s(V,Y),s(V,ge),s(V,k),s(k,M),b(M,e[1][4]),s(k,ye),s(k,D),b(D,e[1][5]),s(k,be),s(k,L),b(L,e[1][6]),s(E,Pe),s(E,U),s(U,W),s(U,i),s(U,o),s(o,n),b(n,e[1][7]),s(o,g),s(o,l),b(l,e[1][8]),s(o,q),s(o,y),b(y,e[1][9]),s(E,B),s(E,z),s(z,j),s(z,Te),s(z,ae),s(ae,ue),s(ae,Oe),s(ae,Z),s(Z,$),s(Z,J),s(Z,Q),s(z,Ce),s(z,ce),s(z,Me),s(z,pe),s(r,De),s(r,K),s(K,ee),s(ee,F),s(ee,Le),s(ee,te),s(K,Re),s(K,se);for(let _=0;_<A.length;_+=1)A[_]&&A[_].m(se,null);e[16](se),ke||(Ye=[p(I,"input",e[7]),p(I,"focus",e[4]),p(I,"blur",e[5]),p(C,"input",e[8]),p(C,"focus",e[4]),p(C,"blur",e[5]),p(O,"input",e[9]),p(O,"focus",e[4]),p(O,"blur",e[5]),p(M,"input",e[10]),p(M,"focus",e[4]),p(M,"blur",e[5]),p(D,"input",e[11]),p(D,"focus",e[4]),p(D,"blur",e[5]),p(L,"input",e[12]),p(L,"focus",e[4]),p(L,"blur",e[5]),p(n,"input",e[13]),p(n,"focus",e[4]),p(n,"blur",e[5]),p(l,"input",e[14]),p(l,"focus",e[4]),p(l,"blur",e[5]),p(y,"input",e[15]),p(y,"focus",e[4]),p(y,"blur",e[5]),p(E,"submit",e[6]),p(E,"reset",pt),p(F,"click",e[3])],ke=!0)},p(c,[S]){if(S&2&&b(I,c[1][1]),S&2&&b(C,c[1][2]),S&2&&b(O,c[1][3]),S&2&&b(M,c[1][4]),S&2&&b(D,c[1][5]),S&2&&b(L,c[1][6]),S&2&&b(n,c[1][7]),S&2&&b(l,c[1][8]),S&2&&b(y,c[1][9]),S&4){he=$e(c[2]);let _;for(_=0;_<he.length;_+=1){const H=Je(c,he,_);A[_]?A[_].p(H,S):(A[_]=Qe(H),A[_].c(),A[_].m(se,null))}for(;_<A.length;_+=1)A[_].d(1);A.length=he.length}},i:Ze,o:Ze,d(c){c&&(h(d),h(P),h(x)),lt(A,c),e[16](null),ke=!1,et(Ye)}}}function ct(e){var d=/[\x00]/g;return e.replace(d,"")}function pt(e){e.preventDefault(),document.getElementById("premise").value="";for(let d=1;d<=9;d++)document.getElementById(`input_${d}`).value=""}function ht(e,d,f){let P;tt(()=>{x()}),st(()=>{x()});function x(){P&&f(0,P.scrollTop=P.scrollHeight,P)}let r={1:"",2:"",3:"",4:"",5:"",6:"",7:"",8:"",9:""},E=!1,N=[];function X(){N.push("")}function we(v){f(2,N[N.length-1]=v,N)}function ve(v,i){f(1,r[i.toString()]=v,r)}function R(){E?(E=!1,f(2,N=[]),le.clearStory(),document.getElementById("story").classList.add("hide"),document.getElementById("story").classList.remove("show")):(E=!0,document.getElementById("story").classList.add("show"),document.getElementById("story").classList.remove("hide"))}let I=null;function ne(){console.log(I);const v=document.querySelectorAll(".labels p"),i=document.querySelectorAll(".group textarea");v.forEach((o,n)=>{n===I?(console.log("focused",n),o.classList.add("active"),console.log(o.classList),i[n].focus()):o.classList.remove("active")})}function C(v){I=parseInt(v.target.id.split("_")[1])-1,ne()}function _e(v){I=v,ne()}function O(){I=null,ne()}async function ie(v){const i="https://as6xb.apps.beam.cloud/generate",o={Authorization:"Basic NzAyMmQyOTRkMjhiZjc2MmQzOGE0YzU2ODNkY2UzMjI6OThhM2E5NDFmMGNmZGU2NWM5MjMyOWExYWZkZjZmNjI=","Content-Type":"application/json"},n=v.stream||!1;let g=null;if(v.index&&(g=v.index,delete v.index),n){const l=await fetch(i,{method:"POST",headers:o,body:JSON.stringify(v),compress:!1,follow:20,size:0,timeout:0});if(l.ok){const q=l.body.getReader();let y=!1,B="";for(;!y;){const{value:z,done:j}=await q.read();let re=new TextDecoder("utf-8").decode(z);re=ct(re);try{B=JSON.parse(re),g?ve(B.text[0].trim(),g):(E||(y=!0),we(B.text[0].trim()))}catch(Te){console.error(Te)}j&&(y=!0)}}else throw new Error("Error:",l.status,l.statusText)}else{const l=await fetch(i,{method:"POST",headers:o,body:JSON.stringify(v)});if(l.ok)return(await l.json()).text[0].trim();console.log("Error:",l.status,l.statusText)}}class V{constructor(i=!1){this.structureTemplate=`## Story Structure
Setup
1.1 Exposition. The status quo or "ordinary world" is established.
1.2 Inciting Incident. An event that sets the story in motion.
1.3 Plot Point A. The protagonist decides to tackle the challenge head-on. They "cross the threshold" and the story is now truly moving.

Confrontation
2.1 Rising Action. The story's true stakes become clear; our hero grows familiar with their "new world" and has their first encounters with some enemies and allies.
2.2 Midpoint. An event that upends the protagonist's mission.
2.3 Plot Point B. In the wake of the disorienting midpoint, the protagonist is tested — and fails. Their ability to succeed is now in doubt.

Resolution
3.1 Pre Climax. The night is darkest before dawn. The protagonist must pull themselves together and choose between decisive action and failure.
3.2 Climax. They face off against their antagonist one last time. Will they prevail?
3.3 Denouement. All loose ends are tied up. The reader discovers the consequences of the climax. A new status quo is established.
`,this.PLOT_POINTS_AMT=9,this.PLOT_POINTS_NUMBERING=[["1.1","Exposition"],["1.2","Inciting Incident"],["1.3","Plot Point A"],["2.1","Rising Action"],["2.2","Midpoint"],["2.3","Plot Point B"],["3.1","Pre Climax"],["3.2","Climax"],["3.3","Denouement"]],this.id=null,this.premise=null,this.genre=null,this.premise=null,this.plotPoints=null,this.overallPlotSummary="1.",this.debug=i}getPromptReadyGenre(){return this.genre?this.genre.replace("_"," "):"science fiction"}extractFromForm(){let i={};for(let o=0;o<this.PLOT_POINTS_AMT;o++){const n=r[o+1];n!==""&&(i[this.PLOT_POINTS_NUMBERING[o][0]]={description:n})}this.plotPoints=i,this.premise=document.getElementById("premise").value,this.genre=document.getElementById("genre").value}plotPointsToPrompt(){const i=[];for(const[n,g]of this.PLOT_POINTS_NUMBERING)n in this.plotPoints?i.push(this.plotPoints[n].description):i.push("");return`
## Story Events
Setup

1.1 ${i[0]}
1.2 ${i[1]}
1.3 ${i[2]}

Confrontation

2.1 ${i[3]}
2.2 ${i[4]}
2.3 ${i[5]}

Resolution

3.1 ${i[6]}
3.2 ${i[7]}
3.3 ${i[8]}
`}getPreviousSectionContext(i,o){let g=this.plotPoints[i].text.split(`
`),l=[];for(;l.join("").length<o&&g.length>0;)l.push(g.pop());return l.reverse().join(`
`)}async constructDraftPrompt(i){const o=this.PLOT_POINTS_NUMBERING.map(([j,re])=>j),n=o.indexOf(i),g=n>0,l=n===o.length-1;let q="",y="",B="";return g?(q=this.plotPoints[o[n-1]].summary??await this.summariseStory(o[n-1]),q=`
Here is a summary of the plot so far:
`+q+`
Using the provided summary for the plot so far, write a narrative section for the current plot point to continue the plot.`,B=this.getPreviousSectionContext(o[n-1],200)):q="Write a narrative section for the current plot point which will kick off the plot and establish the world.",l&&(y=" This is the final plot point and should resolve the story in a satisfying way."),`[INST] You are a renowned creative writer specialising in the genre of ${this.getPromptReadyGenre()}. ${q} Be creative, explore interesting characters and unusual settings.${y}
Here is the current plot prompt:
${this.plotPoints[i].description}[/INST]${B}`}async summariseStory(i){const o={max_tokens:4096,temperature:.3,repetition_penalty:1.15,top_p:1,min_p:.1};let n=this.plotPoints[i].text,g=`[INST]You are a helpful assistant to a writer. You have been asked to update a numbered list of key plot points taken place in the story so far. Please take the newest text passage and add the most important key points to the key plot points so far. Here are the key plot points so far: ${this.overallPlotSummary} Here is the text: ${n}[/INST]`,l="";console.log("summarise prompt",g);try{l=await ie({prompt:g,stream:!1,sampling_params:o})}catch{l=this.overallPlotSummary}return this.plotPoints[i].summary=l,this.overallPlotSummary=l,this.debug&&console.log(`Summarised plot up to ${i} as
-----------------------------
${l}`),l}getPromptReadyPremise(){return"Premise: "+this.premise}clearStory(){this.plotPoints=null}async generatePlotPoints(){this.extractFromForm();const i={max_tokens:4096,temperature:.6,stop:[`
`],repetition_penalty:1.15,top_p:1,min_p:.1};for(let o=0;o<this.PLOT_POINTS_AMT;o++){_e(o);const n=this.PLOT_POINTS_NUMBERING[o][0],g=this.PLOT_POINTS_NUMBERING[o][1];if(console.log(n,this.plotPoints),n in this.plotPoints)continue;const l=this.plotPointsToPrompt();let y={prompt:`[INST]You are a renowned writer specialising in the genre of ${this.getPromptReadyGenre()}. You are able to create engaging narratives following a three act structure. Using the Story Structure guide, fill the Story Events suitable for the story as outlined in the premise.
${this.structureTemplate}${this.getPromptReadyPremise()}${l}
Create a single event for the plot point ${n}, keep it concise and avoid repeating previous plot points.[/INST] ${n} ${g}:`,stream:!0,sampling_params:i,index:o+1};await ie(y).catch(B=>console.error(B)),this.extractFromForm(),O()}this.debug&&console.log(`Generated plot points: ${this.plotPointsToPrompt()}`)}async generateStory(){const i={max_tokens:4096,temperature:.8,repetition_penalty:1.15,top_p:1,min_p:.1};for(let o=0;o<this.PLOT_POINTS_AMT&&E;o++){const n=this.PLOT_POINTS_NUMBERING[o][0],g=await this.constructDraftPrompt(n);this.plotPoints[n].draft_prompt=g,X();let l={prompt:g,stream:!0,sampling_params:i,lora:this.genre};this.debug&&(console.log(`Payload for plot point ${n}:`),console.log(l)),await ie(l).catch(q=>console.error(q)),this.plotPoints[n].text=N[o],this.debug&&console.log(`Generated plot point ${n}`)}}}function Y(v){v.preventDefault(),le.generatePlotPoints().then(()=>R()).then(()=>le.generateStory()).then(()=>console.log(le.plotPoints))}let le=new V(!0);function ge(){r[1]=this.value,f(1,r)}function k(){r[2]=this.value,f(1,r)}function M(){r[3]=this.value,f(1,r)}function ye(){r[4]=this.value,f(1,r)}function D(){r[5]=this.value,f(1,r)}function be(){r[6]=this.value,f(1,r)}function L(){r[7]=this.value,f(1,r)}function Pe(){r[8]=this.value,f(1,r)}function U(){r[9]=this.value,f(1,r)}function W(v){ot[v?"unshift":"push"](()=>{P=v,f(0,P)})}return[P,r,N,R,C,O,Y,ge,k,M,ye,D,be,L,Pe,U,W]}class vt extends nt{constructor(d){super(),it(this,d,ht,ut,Ke,{})}}export{vt as component};
