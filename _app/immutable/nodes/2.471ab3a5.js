import{s as lt,n as ke,r as ut,o as ct,a as dt,b as ht}from"../chunks/scheduler.e108d1fd.js";import{S as rt,i as at,g as r,h as a,j as _,f as m,k as e,a as be,s as T,y as J,c as P,z as w,x as n,A as f,t as $e,b as pt,d as Xe,B as mt,H as ft,C as vt,p as _t,l as gt,r as bt,u as yt,v as Tt,w as Pt}from"../chunks/index.7e4bc2c2.js";import"../chunks/paths.c4b5fdbf.js";function nt(t){return(t==null?void 0:t.length)!==void 0?t:Array.from(t)}function wt(t){let o;return{c(){o=r("div"),this.h()},l(l){o=a(l,"DIV",{class:!0}),_(o).forEach(m),this.h()},h(){e(o,"class","spinner svelte-1ny5i23")},m(l,p){be(l,o,p)},p:ke,i:ke,o:ke,d(l){l&&m(o)}}}class xt extends rt{constructor(o){super(),at(this,o,null,wt,lt,{})}}function ot(t,o,l){const p=t.slice();return p[34]=o[l],p}function Et(t){let o;return{c(){o=r("div"),this.h()},l(l){o=a(l,"DIV",{style:!0}),_(o).forEach(m),this.h()},h(){gt(o,"width","50px")},m(l,p){be(l,o,p)},i:ke,o:ke,d(l){l&&m(o)}}}function St(t){let o,l;return o=new xt({}),{c(){bt(o.$$.fragment)},l(p){yt(o.$$.fragment,p)},m(p,y){Tt(o,p,y),l=!0},i(p){l||(Xe(o.$$.fragment,p),l=!0)},o(p){$e(o.$$.fragment,p),l=!1},d(p){Pt(o,p)}}}function it(t){let o,l,p=t[34]+"";return{c(){o=r("p"),l=new ft(!1),this.h()},l(y){o=a(y,"P",{class:!0});var x=_(o);l=vt(x,!1),x.forEach(m),this.h()},h(){l.a=null,e(o,"class","svelte-u4c1n2")},m(y,x){be(y,o,x),l.m(p,o)},p(y,x){x[0]&8&&p!==(p=y[34]+"")&&l.p(p)},d(y){y&&m(o)}}}function It(t){let o,l=`<meta charset="UTF-8"/> <meta name="viewport" content="width=device-width, initial-scale=1.0"/> <title>StoryGen</title> <style>html {
      background-color: #374259; /* Change this to the color you want */
      scrollbar-color: #5c8984 #192235;
    }</style>`,p,y,x,h,O,L,ue=`<p id="label_1" class="svelte-u4c1n2"><b>Exposition</b><br/>The status quo or ‘ordinary world’ is
            established.</p> <p id="label_2" class="svelte-u4c1n2"><b>Inciting Incident</b><br/>An event that sets the story in
            motion.</p> <p id="label_3" class="svelte-u4c1n2"><b>Plot Point A</b><br/>The protagonist decides to tackle the
            challenge head-on. They ‘cross the threshold,’ and the story is now
            truly moving.</p>`,ye,j,D,Te,C,me,S,ce,X,ee,Pe=`<p id="label_4" class="svelte-u4c1n2"><b>Rising Action</b><br/>The story&#39;s true stakes become clear; our
            hero grows familiar with their ‘new world’ and has their first
            encounters with some enemies and allies.</p> <p id="label_5" class="svelte-u4c1n2"><b>Midpoint</b><br/>An event that upends the protagonist’s mission.</p> <p id="label_6" class="svelte-u4c1n2"><b>Plot Point B</b><br/>In the wake of the disorienting midpoint,
            the protagonist is tested — and fails. Their ability to succeed is
            now in doubt.</p>`,we,F,M,xe,B,te,R,Ee,Y,se,Ne=`<p id="label_7" class="svelte-u4c1n2"><b>Pre Climax</b><br/>Night is darkest before dawn. The protagonist
            must pull themselves together and choose between decisive action and
            failure.</p> <p id="label_8" class="svelte-u4c1n2"><b>Climax</b><br/>They face off against their antagonist one last
            time. Will they prevail?</p> <p id="label_9" class="svelte-u4c1n2"><b>Denouement</b><br/>All loose ends are tied up. The reader
            discovers the consequences of the climax. A new status quo is
            established.</p>`,Se,q,H,Ie,V,c,s,u,i,g,v='<label for="premise" class="svelte-u4c1n2">Enter your story premise here:</label> <textarea id="premise" name="premise" class="svelte-u4c1n2"></textarea>',A,I,k,Ae="Genre",de,G,$,Ye="Science Fiction ",Q,ze="Ghost Stories",Re,le,We='<button type="submit" class="svelte-u4c1n2">Generate Story!</button> <button type="reset" class="svelte-u4c1n2">Reset</button>',He,re,z,W,Ve,ne,oe,Z,Ze='<svg class="w-6 h-6 text-gray-800 dark:text-white" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 13V4M7 14H5a1 1 0 0 0-1 1v4a1 1 0 0 0 1 1h14a1 1 0 0 0 1-1v-4a1 1 0 0 0-1-1h-2m-1-5-4 5-4-5m9 8h.01"></path></svg>',Ge,K,Je='<svg class="w-6 h-6 text-gray-800 dark:text-white" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m15 9-6 6m0-6 6 6m6-3a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"></path></svg>',je,ie,Le,Ue,Qe;const Ke=[St,Et],he=[];function et(d,E){return d[1]?0:1}z=et(t),W=he[z]=Ke[z](t);let fe=nt(t[3]),N=[];for(let d=0;d<fe.length;d+=1)N[d]=it(ot(t,fe,d));return{c(){o=r("head"),o.innerHTML=l,p=T(),y=r("body"),x=r("div"),h=r("form"),O=r("div"),L=r("div"),L.innerHTML=ue,ye=T(),j=r("div"),D=r("textarea"),Te=T(),C=r("textarea"),me=T(),S=r("textarea"),ce=T(),X=r("div"),ee=r("div"),ee.innerHTML=Pe,we=T(),F=r("div"),M=r("textarea"),xe=T(),B=r("textarea"),te=T(),R=r("textarea"),Ee=T(),Y=r("div"),se=r("div"),se.innerHTML=Ne,Se=T(),q=r("div"),H=r("textarea"),Ie=T(),V=r("textarea"),c=T(),s=r("textarea"),u=T(),i=r("div"),g=r("div"),g.innerHTML=v,A=T(),I=r("div"),k=r("label"),k.textContent=Ae,de=T(),G=r("select"),$=r("option"),$.textContent=Ye,Q=r("option"),Q.textContent=ze,Re=T(),le=r("div"),le.innerHTML=We,He=T(),re=r("div"),W.c(),Ve=T(),ne=r("div"),oe=r("div"),Z=r("button"),Z.innerHTML=Ze,Ge=T(),K=r("button"),K.innerHTML=Je,je=T(),ie=r("div");for(let d=0;d<N.length;d+=1)N[d].c();this.h()},l(d){o=a(d,"HEAD",{"data-svelte-h":!0}),J(o)!=="svelte-8f0cjy"&&(o.innerHTML=l),p=P(d),y=a(d,"BODY",{class:!0});var E=_(y);x=a(E,"DIV",{class:!0});var U=_(x);h=a(U,"FORM",{});var b=_(h);O=a(b,"DIV",{class:!0,id:!0});var pe=_(O);L=a(pe,"DIV",{class:!0,"data-svelte-h":!0}),J(L)!=="svelte-104jyac"&&(L.innerHTML=ue),ye=P(pe),j=a(pe,"DIV",{class:!0});var ve=_(j);D=a(ve,"TEXTAREA",{id:!0,name:!0,class:!0}),_(D).forEach(m),Te=P(ve),C=a(ve,"TEXTAREA",{id:!0,name:!0,class:!0}),_(C).forEach(m),me=P(ve),S=a(ve,"TEXTAREA",{id:!0,name:!0,class:!0}),_(S).forEach(m),ve.forEach(m),pe.forEach(m),ce=P(b),X=a(b,"DIV",{class:!0,id:!0});var Me=_(X);ee=a(Me,"DIV",{class:!0,"data-svelte-h":!0}),J(ee)!=="svelte-1345n85"&&(ee.innerHTML=Pe),we=P(Me),F=a(Me,"DIV",{class:!0});var _e=_(F);M=a(_e,"TEXTAREA",{id:!0,name:!0,class:!0}),_(M).forEach(m),xe=P(_e),B=a(_e,"TEXTAREA",{id:!0,name:!0,class:!0}),_(B).forEach(m),te=P(_e),R=a(_e,"TEXTAREA",{id:!0,name:!0,class:!0}),_(R).forEach(m),_e.forEach(m),Me.forEach(m),Ee=P(b),Y=a(b,"DIV",{class:!0,id:!0});var Oe=_(Y);se=a(Oe,"DIV",{class:!0,"data-svelte-h":!0}),J(se)!=="svelte-qjlgz7"&&(se.innerHTML=Ne),Se=P(Oe),q=a(Oe,"DIV",{class:!0});var ge=_(q);H=a(ge,"TEXTAREA",{id:!0,name:!0,class:!0}),_(H).forEach(m),Ie=P(ge),V=a(ge,"TEXTAREA",{id:!0,name:!0,class:!0}),_(V).forEach(m),c=P(ge),s=a(ge,"TEXTAREA",{id:!0,name:!0,class:!0}),_(s).forEach(m),ge.forEach(m),Oe.forEach(m),u=P(b),i=a(b,"DIV",{class:!0,id:!0});var ae=_(i);g=a(ae,"DIV",{id:!0,class:!0,"data-svelte-h":!0}),J(g)!=="svelte-1pw1n04"&&(g.innerHTML=v),A=P(ae),I=a(ae,"DIV",{id:!0,class:!0});var Ce=_(I);k=a(Ce,"LABEL",{for:!0,class:!0,"data-svelte-h":!0}),J(k)!=="svelte-pcardo"&&(k.textContent=Ae),de=P(Ce),G=a(Ce,"SELECT",{name:!0,id:!0,class:!0});var Fe=_(G);$=a(Fe,"OPTION",{class:!0,"data-svelte-h":!0}),J($)!=="svelte-1mfk9b9"&&($.textContent=Ye),Q=a(Fe,"OPTION",{class:!0,"data-svelte-h":!0}),J(Q)!=="svelte-ll1gq9"&&(Q.textContent=ze),Fe.forEach(m),Ce.forEach(m),Re=P(ae),le=a(ae,"DIV",{id:!0,class:!0,"data-svelte-h":!0}),J(le)!=="svelte-1uwb28s"&&(le.innerHTML=We),He=P(ae),re=a(ae,"DIV",{id:!0,class:!0});var tt=_(re);W.l(tt),tt.forEach(m),ae.forEach(m),b.forEach(m),Ve=P(U),ne=a(U,"DIV",{id:!0,class:!0});var De=_(ne);oe=a(De,"DIV",{id:!0,class:!0});var Be=_(oe);Z=a(Be,"BUTTON",{type:!0,id:!0,"aria-label":!0,class:!0,"data-svelte-h":!0}),J(Z)!=="svelte-ypfi1j"&&(Z.innerHTML=Ze),Ge=P(Be),K=a(Be,"BUTTON",{type:!0,id:!0,class:!0,"data-svelte-h":!0}),J(K)!=="svelte-1eav1pu"&&(K.innerHTML=Je),Be.forEach(m),je=P(De),ie=a(De,"DIV",{id:!0,class:!0});var st=_(ie);for(let qe=0;qe<N.length;qe+=1)N[qe].l(st);st.forEach(m),De.forEach(m),U.forEach(m),E.forEach(m),this.h()},h(){e(L,"class","labels svelte-u4c1n2"),e(D,"id","input_1"),e(D,"name","input_1"),e(D,"class","svelte-u4c1n2"),e(C,"id","input_2"),e(C,"name","input_2"),e(C,"class","svelte-u4c1n2"),e(S,"id","input_3"),e(S,"name","input_3"),e(S,"class","svelte-u4c1n2"),e(j,"class","group svelte-u4c1n2"),e(O,"class","box svelte-u4c1n2"),e(O,"id","topBox"),e(ee,"class","labels svelte-u4c1n2"),e(M,"id","input_4"),e(M,"name","input_4"),e(M,"class","svelte-u4c1n2"),e(B,"id","input_5"),e(B,"name","input_5"),e(B,"class","svelte-u4c1n2"),e(R,"id","input_6"),e(R,"name","input_6"),e(R,"class","svelte-u4c1n2"),e(F,"class","group svelte-u4c1n2"),e(X,"class","box svelte-u4c1n2"),e(X,"id","middleBox"),e(se,"class","labels svelte-u4c1n2"),e(H,"id","input_7"),e(H,"name","input_7"),e(H,"class","svelte-u4c1n2"),e(V,"id","input_8"),e(V,"name","input_8"),e(V,"class","svelte-u4c1n2"),e(s,"id","input_9"),e(s,"name","input_9"),e(s,"class","svelte-u4c1n2"),e(q,"class","group svelte-u4c1n2"),e(Y,"class","box svelte-u4c1n2"),e(Y,"id","bottomBox"),e(g,"id","premiseBox"),e(g,"class","svelte-u4c1n2"),e(k,"for","genre"),e(k,"class","svelte-u4c1n2"),$.__value="science_fiction",w($,$.__value),e($,"class","svelte-u4c1n2"),Q.__value="ghost_stories",w(Q,Q.__value),e(Q,"class","svelte-u4c1n2"),e(G,"name","genre"),e(G,"id","genre"),e(G,"class","svelte-u4c1n2"),e(I,"id","genreBox"),e(I,"class","svelte-u4c1n2"),e(le,"id","buttonBox"),e(le,"class","svelte-u4c1n2"),e(re,"id","loadingSpinnerContainer"),e(re,"class","svelte-u4c1n2"),e(i,"class","box svelte-u4c1n2"),e(i,"id","bottom"),e(Z,"type","button"),e(Z,"id","download"),e(Z,"aria-label","Download Text"),e(Z,"class","svelte-u4c1n2"),e(K,"type","button"),e(K,"id","close"),e(K,"class","svelte-u4c1n2"),e(oe,"id","buttonContainer"),e(oe,"class","svelte-u4c1n2"),e(ie,"id","scrollDiv"),e(ie,"class","svelte-u4c1n2"),e(ne,"id","story"),e(ne,"class","hide svelte-u4c1n2"),e(x,"class","container svelte-u4c1n2"),e(y,"class","svelte-u4c1n2")},m(d,E){be(d,o,E),be(d,p,E),be(d,y,E),n(y,x),n(x,h),n(h,O),n(O,L),n(O,ye),n(O,j),n(j,D),w(D,t[2][1]),n(j,Te),n(j,C),w(C,t[2][2]),n(j,me),n(j,S),w(S,t[2][3]),n(h,ce),n(h,X),n(X,ee),n(X,we),n(X,F),n(F,M),w(M,t[2][4]),n(F,xe),n(F,B),w(B,t[2][5]),n(F,te),n(F,R),w(R,t[2][6]),n(h,Ee),n(h,Y),n(Y,se),n(Y,Se),n(Y,q),n(q,H),w(H,t[2][7]),n(q,Ie),n(q,V),w(V,t[2][8]),n(q,c),n(q,s),w(s,t[2][9]),n(h,u),n(h,i),n(i,g),n(i,A),n(i,I),n(I,k),n(I,de),n(I,G),n(G,$),n(G,Q),n(i,Re),n(i,le),n(i,He),n(i,re),he[z].m(re,null),n(x,Ve),n(x,ne),n(ne,oe),n(oe,Z),n(oe,Ge),n(oe,K),n(ne,je),n(ne,ie);for(let U=0;U<N.length;U+=1)N[U]&&N[U].m(ie,null);t[19](ie),Le=!0,Ue||(Qe=[f(D,"input",t[10]),f(D,"focus",t[6]),f(D,"blur",t[7]),f(C,"input",t[11]),f(C,"focus",t[6]),f(C,"blur",t[7]),f(S,"input",t[12]),f(S,"focus",t[6]),f(S,"blur",t[7]),f(M,"input",t[13]),f(M,"focus",t[6]),f(M,"blur",t[7]),f(B,"input",t[14]),f(B,"focus",t[6]),f(B,"blur",t[7]),f(R,"input",t[15]),f(R,"focus",t[6]),f(R,"blur",t[7]),f(H,"input",t[16]),f(H,"focus",t[6]),f(H,"blur",t[7]),f(V,"input",t[17]),f(V,"focus",t[6]),f(V,"blur",t[7]),f(s,"input",t[18]),f(s,"focus",t[6]),f(s,"blur",t[7]),f(h,"submit",t[9]),f(h,"reset",t[8]),f(Z,"click",t[4]),f(K,"click",t[5])],Ue=!0)},p(d,E){E[0]&4&&w(D,d[2][1]),E[0]&4&&w(C,d[2][2]),E[0]&4&&w(S,d[2][3]),E[0]&4&&w(M,d[2][4]),E[0]&4&&w(B,d[2][5]),E[0]&4&&w(R,d[2][6]),E[0]&4&&w(H,d[2][7]),E[0]&4&&w(V,d[2][8]),E[0]&4&&w(s,d[2][9]);let U=z;if(z=et(d),z!==U&&(_t(),$e(he[U],1,1,()=>{he[U]=null}),pt(),W=he[z],W||(W=he[z]=Ke[z](d),W.c()),Xe(W,1),W.m(re,null)),E[0]&8){fe=nt(d[3]);let b;for(b=0;b<fe.length;b+=1){const pe=ot(d,fe,b);N[b]?N[b].p(pe,E):(N[b]=it(pe),N[b].c(),N[b].m(ie,null))}for(;b<N.length;b+=1)N[b].d(1);N.length=fe.length}},i(d){Le||(Xe(W),Le=!0)},o(d){$e(W),Le=!1},d(d){d&&(m(o),m(p),m(y)),he[z].d(),mt(N,d),t[19](null),Ue=!1,ut(Qe)}}}function At(t){var o=/[\x00]/g;return t.replace(o,"")}function kt(t,o,l){let p;ct(()=>{y()}),dt(()=>{y()});function y(){p&&l(0,p.scrollTop=p.scrollHeight,p)}let x=!1,h={1:"",2:"",3:"",4:"",5:"",6:"",7:"",8:"",9:""},O=!1,L=[],ue="";function ye(){if(ue.trim()!==""){const c=document.createElement("a"),s=new Blob([ue],{type:"text/plain"});c.href=URL.createObjectURL(s),c.download="downloaded-text.txt",c.setAttribute("aria-hidden","true"),c.style.display="none",document.body.appendChild(c),c.click(),document.body.removeChild(c),URL.revokeObjectURL(c.href)}}function j(){l(1,x=!x)}function D(){L.push("")}function Te(c){l(3,L[L.length-1]=c,L)}function C(c,s){l(2,h[s.toString()]=c,h)}function me(){O?(O=!1,l(3,L=[]),ue="",te.clearStory(),document.getElementById("story").classList.add("hide"),document.getElementById("story").classList.remove("show")):(O=!0,document.getElementById("story").classList.add("show"),document.getElementById("story").classList.remove("hide"))}let S=null;function ce(){console.log(S);const c=document.querySelectorAll(".labels p"),s=document.querySelectorAll(".group textarea");c.forEach((u,i)=>{i===S?(console.log("focused",i),u.classList.add("active"),console.log(u.classList),s[i].focus()):u.classList.remove("active")})}function X(c){S=parseInt(c.target.id.split("_")[1])-1,ce()}function ee(c){S=c,ce()}function Pe(){S=null,ce()}function we(c){c.preventDefault(),te.clearStory(),document.getElementById("premise").value="";for(let s=1;s<=9;s++)C("",s)}function F(){ue=L.join(`
`)}async function M(c){const s="https://as6xb.apps.beam.cloud/generate",u={Authorization:"Basic NzAyMmQyOTRkMjhiZjc2MmQzOGE0YzU2ODNkY2UzMjI6OThhM2E5NDFmMGNmZGU2NWM5MjMyOWExYWZkZjZmNjI=","Content-Type":"application/json"},i=c.stream||!1;let g=null;if(c.index&&(g=c.index,delete c.index),i){const v=await fetch(s,{method:"POST",headers:u,body:JSON.stringify(c),compress:!1,follow:20,size:0,timeout:0});if(v.ok){const A=v.body.getReader();let I=!1,k="";for(;!I;){const{value:Ae,done:de}=await A.read();let G=new TextDecoder("utf-8").decode(Ae);G=At(G);try{k=JSON.parse(G),g?C(k.text[0].trim(),g):(O||(I=!0),Te(k.text[0].trim()))}catch($){console.error($)}de&&(I=!0)}}else throw new Error("Error:",v.status,v.statusText)}else{const v=await fetch(s,{method:"POST",headers:u,body:JSON.stringify(c)});if(v.ok)return(await v.json()).text[0].trim();console.log("Error:",v.status,v.statusText)}}class xe{constructor(s=!1){this.structureTemplate=`## Story Structure
Setup
1.1 Exposition. The status quo or "ordinary world" is established.
1.2 Inciting Incident. An event that sets the story in motion.
1.3 Plot Point A. The protagonist decides to tackle the challenge head-on. They "cross the threshold" and the story is now truly moving.

Confrontation
2.1 Rising Action. The story's true stakes become clear; our hero grows familiar with their "new world" and has their first encounters with some enemies and allies.
2.2 Midpoint. An event that upends the protagonist's mission.
2.3 Plot Point B. In the wake of the disorienting midpoint, the protagonist is tested — and fails. Their ability to succeed is now in doubt.

Resolution
3.1 Pre Climax. The night is darkest before dawn. The protagonist must pull themselves together and choose between decisive action and failure.
3.2 Climax. They face off against their antagonist one last time. Will they prevail?
3.3 Denouement. All loose ends are tied up. The reader discovers the consequences of the climax. A new status quo is established.
`,this.PLOT_POINTS_AMT=9,this.PLOT_POINTS_NUMBERING=[["1.1","Exposition"],["1.2","Inciting Incident"],["1.3","Plot Point A"],["2.1","Rising Action"],["2.2","Midpoint"],["2.3","Plot Point B"],["3.1","Pre Climax"],["3.2","Climax"],["3.3","Denouement"]],this.id=null,this.premise=null,this.genre=null,this.premise=null,this.plotPoints=null,this.overallPlotSummary="1.",this.debug=s}getPromptReadyGenre(){return this.genre?this.genre.replace("_"," "):"science fiction"}extractFromForm(){let s={};for(let u=0;u<this.PLOT_POINTS_AMT;u++){const i=h[u+1];i!==""&&(s[this.PLOT_POINTS_NUMBERING[u][0]]={description:i})}this.plotPoints=s,this.premise=document.getElementById("premise").value,this.genre=document.getElementById("genre").value}plotPointsToPrompt(){const s=[];for(const[i,g]of this.PLOT_POINTS_NUMBERING)i in this.plotPoints?s.push(this.plotPoints[i].description):s.push("");return`
## Story Events
Setup

1.1 ${s[0]}
1.2 ${s[1]}
1.3 ${s[2]}

Confrontation

2.1 ${s[3]}
2.2 ${s[4]}
2.3 ${s[5]}

Resolution

3.1 ${s[6]}
3.2 ${s[7]}
3.3 ${s[8]}
`}getPreviousSectionContext(s,u){let g=this.plotPoints[s].text.split(`
`),v=[];for(;v.join("").length<u&&g.length>0;)v.push(g.pop());return v.reverse().join(`
`)}async constructDraftPrompt(s){const u=this.PLOT_POINTS_NUMBERING.map(([de,G])=>de),i=u.indexOf(s),g=i>0,v=i===u.length-1;let A="",I="",k="";return g?(A=this.plotPoints[u[i-1]].summary??await this.summariseStory(u[i-1]),A=`
Here is a summary of the plot so far:
`+A+`
Using the provided summary for the plot so far, write a narrative section for the current plot point to continue the plot.`,k=this.getPreviousSectionContext(u[i-1],200)):A="Write a narrative section for the current plot point which will kick off the plot and establish the world.",v&&(I=" This is the final plot point and should resolve the story in a satisfying way."),`[INST] You are a renowned creative writer specialising in the genre of ${this.getPromptReadyGenre()}. ${A} Be creative, explore interesting characters and unusual settings.${I}
Here is the current plot prompt:
${this.plotPoints[s].description}[/INST]${k}`}async summariseStory(s){const u={max_tokens:4096,temperature:.3,repetition_penalty:1.15,top_p:1,min_p:.1};let i=this.plotPoints[s].text,g=`[INST]You are a helpful assistant to a writer. You have been asked to update an extremely concise story summary. Please take the newest text passage and add the most important key points to summary so far. Keep it brief! Here is the summary so far: ${this.overallPlotSummary} Here is the text: ${i}[/INST]`,v="";console.log("summarise prompt",g);try{v=await M({prompt:g,stream:!1,sampling_params:u})}catch{v=this.overallPlotSummary}return this.plotPoints[s].summary=v,this.overallPlotSummary=v,this.debug&&console.log(`Summarised plot up to ${s} as
-----------------------------
${v}`),v}getPromptReadyPremise(){return"Premise: "+this.premise}clearStory(){this.plotPoints=null,this.overallPlotSummary="1."}async generatePlotPoints(){j(),this.extractFromForm();const s={max_tokens:4096,temperature:.6,stop:[`
`],repetition_penalty:1.15,top_p:1,min_p:.1};for(let u=0;u<this.PLOT_POINTS_AMT;u++){ee(u);const i=this.PLOT_POINTS_NUMBERING[u][0],g=this.PLOT_POINTS_NUMBERING[u][1];if(console.log(i,this.plotPoints),i in this.plotPoints)continue;const v=this.plotPointsToPrompt();let I={prompt:`[INST]You are a renowned writer specialising in the genre of ${this.getPromptReadyGenre()}. You are able to create engaging narratives following a three act structure. Using the Story Structure guide, fill the Story Events suitable for the story as outlined in the premise.
${this.structureTemplate}${this.getPromptReadyPremise()}${v}
Create a single event for the plot point ${i}, keep it concise and avoid repeating previous plot points.[/INST] ${i} ${g}:`,stream:!0,sampling_params:s,index:u+1};await M(I).catch(k=>console.error(k)),this.extractFromForm(),Pe()}this.debug&&console.log(`Generated plot points: ${this.plotPointsToPrompt()}`),j()}async generateStory(){const s={max_tokens:4096,temperature:.8,repetition_penalty:1.15,top_p:1,min_p:.1};for(let u=0;u<this.PLOT_POINTS_AMT&&O;u++){const i=this.PLOT_POINTS_NUMBERING[u][0],g=await this.constructDraftPrompt(i);this.plotPoints[i].draft_prompt=g,D();let v={prompt:g,stream:!0,sampling_params:s,lora:this.genre};this.debug&&(console.log(`Payload for plot point ${i}:`),console.log(v)),await M(v).catch(A=>console.error(A)),this.plotPoints[i].text=L[u],this.debug&&console.log(`Generated plot point ${i}`)}}}function B(c){c.preventDefault(),te.generatePlotPoints().then(()=>me()).then(()=>te.generateStory()).then(()=>console.log(te.plotPoints)).then(()=>F())}let te=new xe(!0);function R(){h[1]=this.value,l(2,h)}function Ee(){h[2]=this.value,l(2,h)}function Y(){h[3]=this.value,l(2,h)}function se(){h[4]=this.value,l(2,h)}function Ne(){h[5]=this.value,l(2,h)}function Se(){h[6]=this.value,l(2,h)}function q(){h[7]=this.value,l(2,h)}function H(){h[8]=this.value,l(2,h)}function Ie(){h[9]=this.value,l(2,h)}function V(c){ht[c?"unshift":"push"](()=>{p=c,l(0,p)})}return[p,x,h,L,ye,me,X,Pe,we,B,R,Ee,Y,se,Ne,Se,q,H,Ie,V]}class Ot extends rt{constructor(o){super(),at(this,o,kt,It,lt,{},null,[-1,-1])}}export{Ot as component};
